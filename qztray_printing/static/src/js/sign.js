qz.security.setCertificatePromise(function (resolve, reject) {
    resolve("-----BEGIN CERTIFICATE-----\nMIIERTCCAy2gAwIBAgIUPfKb0daujvui2GzX5Ji1i3dgpPswDQYJKoZIhvcNAQEL\nBQAwgbAxCzAJBgNVBAYTAlNWMRUwEwYDVQQIDAxTYW4gU2FsdmFkb3IxFTATBgNV\nBAcMDFNhbiBTYWx2YWRvcjEUMBIGA1UECgwLUE9TIEV4cGVydHMxHTAbBgNVBAsM\nFFNvZnR3YXJlIERldmVsb3BtZW50MRIwEAYDVQQDDAlsb2NhbGhvc3QxKjAoBgkq\nhkiG9w0BCQEWG2Nhcmxvc21vcmFuLmRldkBvdXRsb29rLmNvbTAgFw0yMTAzMjgw\nNDI4MzVaGA8yMDUyMDkyMDA0MjgzNVowgbAxCzAJBgNVBAYTAlNWMRUwEwYDVQQI\nDAxTYW4gU2FsdmFkb3IxFTATBgNVBAcMDFNhbiBTYWx2YWRvcjEUMBIGA1UECgwL\nUE9TIEV4cGVydHMxHTAbBgNVBAsMFFNvZnR3YXJlIERldmVsb3BtZW50MRIwEAYD\nVQQDDAlsb2NhbGhvc3QxKjAoBgkqhkiG9w0BCQEWG2Nhcmxvc21vcmFuLmRldkBv\ndXRsb29rLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAM6dILyi\nIV5TgralToBcNLJBRXHxuIHVsr4KKNGl2hcFZKJw3JxuB07hMLzYmS1RR2D2dNvk\neUPg5AHs+7U5TtFmSQXoWofOED4PbIG8CYrqLmqn8VlhzHjEwSrY+dVMtGuOmGPF\nev48ic+aD+OcMMAKp4GON344rYiIK\/4kSF3AHq+38m+rW+5+nKQixG28QrnxCSlt\nE13ioLOUQ4wWYtgraXQSDdulCyC6heLxYGMqXkqbrM3wE9RgLHsQ9QB+KWx2F6lJ\njadEx\/MnQsXvQfEZh1gXEMtnACVA3NqFCeNe4DkVJHGZvAb8pvKmahK\/pO1OAWfH\nhGJjmvWJ\/nJYZDUCAwEAAaNTMFEwHQYDVR0OBBYEFIe7lqdpxtNdMjwxL7t\/pZQf\nNg4xMB8GA1UdIwQYMBaAFIe7lqdpxtNdMjwxL7t\/pZQfNg4xMA8GA1UdEwEB\/wQF\nMAMBAf8wDQYJKoZIhvcNAQELBQADggEBAFjx\/uUGHG1HYTO4K8TxPvw1OSAgSfQQ\nKckiimMl06Nad2Vi7atoFaOKx7QhG99DQQjTi+T5g3YQmh1y6vwH+2QmiVhzAnuu\ni7jAH2srmrxNRJ3pXI5v5s2EanZgH4KrhB6cUtyZFnO0Lrp3JIs137fKG0bJaVVQ\nFoF9MmQRBCBN9L4sPVi+tpGOdnPtpLgPqwXXL8gL0rlUZPFSGXSakFDh1hiRfeCk\n0f\/76OZ40ybxgCUAIfb3vN7c3edVH7CeSY0PLBcYQh5P9zSfJuYbykmxcot8AhxN\nI5mqiI0JGu9mKqVR3obCCKH2QkjA8QtHAFK0yORLcj4KH3xjzt262CA=\n-----END CERTIFICATE-----\n");
});

var privateKey = "-----BEGIN RSA PRIVATE KEY-----\nMIIEogIBAAKCAQEAzp0gvKIhXlOCtqVOgFw0skFFcfG4gdWyvgoo0aXaFwVkonDc\nnG4HTuEwvNiZLVFHYPZ02+R5Q+DkAez7tTlO0WZJBehah84QPg9sgbwJiuouaqfx\nWWHMeMTBKtj51Uy0a46YY8V6\/jyJz5oP45wwwAqngY43fjitiIgr\/iRIXcAer7fy\nb6tb7n6cpCLEbbxCufEJKW0TXeKgs5RDjBZi2CtpdBIN26ULILqF4vFgYypeSpus\nzfAT1GAsexD1AH4pbHYXqUmNp0TH8ydCxe9B8RmHWBcQy2cAJUDc2oUJ417gORUk\ncZm8Bvym8qZqEr+k7U4BZ8eEYmOa9Yn+clhkNQIDAQABAoIBAHy7BuRZzGMxbxvs\nN7Pt9jIWjWH4VzaqV7m6UGIgCcUUEGiwUb5t\/iN0dwPKjs543up+XpXRHBQKVBuF\ngX8qFZb8dOEIIH8Tu2J71TmM1wXx0gu5T05yaAoQXb0MN+a448J61yyEL3gD+\/5E\nN4tk41lMFUt1G7MrbDecXVKTfMx69EeXE4lM69P2c0AJ4Zd8uDl\/GPLfiykOy36v\nHLwFKRL6oFJuQoEw25pjlpjBTl3U+e9ZvJmo1Y4wlec+3kLe4f\/KepTibwJWHxXy\nomw3p9mTomH70ag0RL8s+FBduPXDrZMxY7MfnBLkWi7NY3wdViUSDbFx6yLAM5N+\nWEJ5X4ECgYEA+zQysnqExyshEvne5EQ+ipzGTq1ftCqq3G4NOTW1E\/wqRGadOM3S\n6PCquk+8xAympvt3WEtwudXPKaV6+fDh\/nl2Z9RoieGC+wVtI1btLDgmIEuBZYeP\nQ5RgYIZn8t6OdiIk2fXyN68HdvalGZN\/EpAm\/YK+kmmRQ8MRJZYYutkCgYEA0o78\n7zP2sR\/NMsNCi4tp\/7ck3P+iO453LJ5jyu6N\/9cj\/JDruodDizjkijHPzjfmdTRA\npT1vSKjh\/uAdaX0cH5HVj7CpzxJPG47bo0I3+JI8Byvco9zRxw1BVv93R89WaQ\/G\np17gv11QBtZZdEGlwZVKF+5AYYUA4zILpu2uwr0CgYBOOlYjYKYixBqbpzazTVFQ\npzvWWoV4POVSme8CRuhqHdgnzvDdNLOemPwB4zz8rJflXmAvHecv6BaIeKEQXuRx\n8+9crDgV4CWC+JChNbvMTnwJCJp2PL3vpLBSvuh2KLqirUVenwncL2Satnp5uYYU\nCNIrlmC0ha2YNZIMa26uGQKBgAWoY\/GFgu51fU0M5B\/dyiZd5Havw8s348nmI6ZT\nTKuAO25Q8pSbh9wY1kNEXWIcLGwf0FDgWrooF5KCsSehffz3LTbkN1viERAbgZlc\ncSaTv1st+YrJpzVjDMtqp+jdEGRYUS00JnPd7QWSAutVzD9sZIZKF57HNSPlt1xv\n7I89AoGALPQuGDSaLJOhq2frCBUgk\/Ogp15KOQzS59JFpeV0ORmIjI98I9kueJ3X\nDIUg\/0hNyCzRy5XXNCFalj0D13FkUhWx9PnskE65UXbp1i0Da41B6EsPoDKiuHEM\nkpCiXwUkhBJaAHOqxy\/JIBLLYkpvIfWy8OnYWkMfitlMHB7BA7A=\n-----END RSA PRIVATE KEY-----\n";

qz.security.setSignaturePromise(function (toSign) {
    return function (resolve, reject) {
        try {
            var pk = new RSAKey();
            pk.readPrivateKeyFromPEMString(strip(privateKey));
            var hex = pk.signString(toSign, 'sha1');
            resolve(stob64(hextorstr(hex)));
        } catch (err) {
            console.error(err);
            reject(err);
        }
    };
});

function strip(key) {
    if (key.indexOf('-----') !== -1) {
        return key.split('-----')[2].replace(/\r?\n|\r/g, '');
    }
}

qz.websocket
    .connect()
    .then(function () {
        console.log('Connected!');
    })